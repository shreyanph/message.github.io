<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Local Message Board</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 40px auto;
            color: #ffffff;
            background-image: url("https://scx1.b-cdn.net/csz/news/800a/2023/data-science.jpg");
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        h2 {
            margin-bottom: 10px;
            color: #ffffff;
        }

        input, textarea, select {
            width: 100%;
            box-sizing: border-box;
            color: #ffffff;
            background: rgba(0,0,0,0.55);
            border: 1px solid rgba(255,255,255,0.25);
            padding: 8px;
        }

        textarea {
            height: 80px;
            resize: vertical;
        }

        button {
            margin-top: 10px;
            color: #ffffff;
            background: rgba(0,0,0,0.65);
            border: 1px solid rgba(255,255,255,0.2);
            padding: 8px 12px;
            cursor: pointer;
        }

        .message {
            border-radius: 999px;
            padding: 10px 16px;
            margin: 6px 0;
            color: #ffffff;
            display: block;
            width: fit-content;
            max-width: 100%;
        }

        .divider {
            border-bottom: 1px solid rgba(255,255,255,0.25);
            margin: 8px 0;
        }

        .name {
            font-weight: bold;
            margin-right: 6px;
            color: #ffffff;
        }

        #messages {
            margin-top: 10px;
        }

        #messages, input, textarea, select {
            backdrop-filter: blur(2px);
        }

        /* Timestamp row: two thin lines with time centered */
        .timestamp-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 8px 0;
            color: #ffffff;
            font-size: 0.9em;
        }
        .timestamp-row .line {
            flex: 1;
            height: 1px;
            background: rgba(255,255,255,0.18);
        }
        .timestamp-row .timestamp-text {
            white-space: nowrap;
            padding: 0 6px;
            color: #ffffff;
            opacity: 0.95;
            font-size: 0.95em;
        }

    </style>
</head>
<body>

<h2>Name List</h2>
<p style="margin-top:0;margin-bottom:6px;">
    Type each name on its own line:
</p>
<textarea id="nameListInput" placeholder="Alice
Bob
Charlie"></textarea>
<br>
<button id="saveNamesBtn">Save Names</button>

<h2 style="margin-top:20px;">Message Board</h2>

<select id="nameSelect" required>
    <option value="" disabled selected>Select a name</option>
</select>
<br><br>

<textarea id="messageInput" placeholder="Type a message..."></textarea>
<br>
<button id="sendBtn">Send</button>

<h2>Message History</h2>
<button id="clearBtn">Clear Message History</button>

<div id="messages"></div>

<script>
    const messagesDiv = document.getElementById('messages');
    const messageInput = document.getElementById('messageInput');
    const nameSelect = document.getElementById('nameSelect');
    const sendBtn = document.getElementById('sendBtn');
    const clearBtn = document.getElementById('clearBtn');

    const nameListInput = document.getElementById('nameListInput');
    const saveNamesBtn = document.getElementById('saveNamesBtn');

    const colors = [
        'rgba(0, 180, 0, 0.7)',     // Green
        'rgba(255, 165, 0, 0.85)',  // Orange
        'rgba(220, 20, 60, 0.85)',  // Red
        'rgba(128, 0, 128, 0.85)',  // Purple
        'rgba(255, 0, 255, 0.85)'   // Magenta
    ];

    function formatTimestamp(iso) {
        const d = new Date(iso);
        if (isNaN(d)) return "";
        // month/day/year h:mm AM/PM, no leading zero for month/day/hour
        const month = d.getMonth() + 1;
        const day = d.getDate();
        const year = d.getFullYear();

        let hour = d.getHours();
        const minute = d.getMinutes().toString().padStart(2, '0');
        const ampm = hour >= 12 ? 'PM' : 'AM';
        hour = hour % 12;
        if (hour === 0) hour = 12;

        return `${month}/${day}/${year} ${hour}:${minute} ${ampm}`;
    }

    function loadMessages() {
        const messages = JSON.parse(localStorage.getItem('messages')) || [];
        let changed = false;

        // ensure each message has a timestamp (so dividers can show them)
        for (let i = 0; i < messages.length; i++) {
            if (!messages[i].time) {
                messages[i].time = new Date().toISOString();
                changed = true;
            }
        }
        if (changed) localStorage.setItem('messages', JSON.stringify(messages));

        messagesDiv.innerHTML = "";

        messages.forEach((msg, index) => {
            const div = document.createElement('div');
            div.className = 'message';

            const color = assignColorToName(msg.name);
            div.style.background = color;

            const nameSpan = document.createElement('span');
            nameSpan.className = 'name';
            nameSpan.textContent = msg.name + ': ';

            div.appendChild(nameSpan);
            div.appendChild(document.createTextNode(msg.text));
            messagesDiv.appendChild(div);

            // if next message is by a different author, add timestamp row for THIS message's time
            if (index < messages.length - 1 && messages[index].name !== messages[index + 1].name) {
                const timestamp = formatTimestamp(messages[index].time || new Date().toISOString());

                const tsRow = document.createElement('div');
                tsRow.className = 'timestamp-row';

                const leftLine = document.createElement('div');
                leftLine.className = 'line';
                tsRow.appendChild(leftLine);

                const tsText = document.createElement('div');
                tsText.className = 'timestamp-text';
                tsText.textContent = timestamp;
                tsRow.appendChild(tsText);

                const rightLine = document.createElement('div');
                rightLine.className = 'line';
                tsRow.appendChild(rightLine);

                messagesDiv.appendChild(tsRow);
            }
        });

        if (messagesDiv.lastElementChild) {
            messagesDiv.lastElementChild.scrollIntoView({ behavior: 'smooth', block: 'end' });
        }
    }

    function addMessage() {
        const name = nameSelect.value.trim();
        const text = messageInput.value.trim();
        if (!name || !text) return;

        const messages = JSON.parse(localStorage.getItem('messages')) || [];
        messages.push({ name, text, time: new Date().toISOString() });
        localStorage.setItem('messages', JSON.stringify(messages));

        messageInput.value = "";
        loadMessages();
    }

    function clearMessages() {
        localStorage.removeItem('messages');
        loadMessages();
    }

    function parseNames(raw) {
        return [...new Set(
            raw.split(/\r?\n|,/).map(n => n.trim()).filter(Boolean)
        )];
    }

    function saveNames() {
        const names = parseNames(nameListInput.value);
        localStorage.setItem('names', JSON.stringify(names));
        names.forEach(assignColorToName);
        loadNames();
    }

    function loadNames() {
        const names = JSON.parse(localStorage.getItem('names')) || [];
        nameSelect.innerHTML = "";

        const placeholder = document.createElement('option');
        placeholder.value = "";
        placeholder.disabled = true;
        placeholder.selected = true;
        placeholder.textContent = "Select a name";
        nameSelect.appendChild(placeholder);

        names.forEach(name => {
            assignColorToName(name);
            const opt = document.createElement('option');
            opt.value = name;
            opt.textContent = name;
            nameSelect.appendChild(opt);
        });

        if (!nameListInput.value && names.length) {
            nameListInput.value = names.join("\n");
        }
    }

    function assignColorToName(name) {
        const map = JSON.parse(localStorage.getItem('nameColorMap')) || {};
        if (map[name]) return map[name];

        const counts = colors.map(() => 0);
        Object.values(map).forEach(c => {
            const i = colors.indexOf(c);
            if (i !== -1) counts[i]++;
        });

        const idx = counts.indexOf(Math.min(...counts));
        map[name] = colors[idx];
        localStorage.setItem('nameColorMap', JSON.stringify(map));
        return map[name];
    }

    messageInput.addEventListener('keydown', e => {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            addMessage();
        }
    });

    sendBtn.addEventListener('click', addMessage);
    clearBtn.addEventListener('click', clearMessages);
    saveNamesBtn.addEventListener('click', saveNames);

    loadNames();
    loadMessages();
</script>

</body>
</html>
